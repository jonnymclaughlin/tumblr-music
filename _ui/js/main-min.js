(function(){var t=this,e=t._,i=Array.prototype,n=Object.prototype,r=Function.prototype,a=i.push,s=i.slice,o=i.concat,u=n.toString,l=n.hasOwnProperty,c=Array.isArray,h=Object.keys,f=r.bind,d=function(t){return t instanceof d?t:this instanceof d?void(this._wrapped=t):new d(t)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=d),exports._=d):t._=d,d.VERSION="1.7.0";var p=function(t,e,i){if(void 0===e)return t;switch(null==i?3:i){case 1:return function(i){return t.call(e,i)};case 2:return function(i,n){return t.call(e,i,n)};case 3:return function(i,n,r){return t.call(e,i,n,r)};case 4:return function(i,n,r,a){return t.call(e,i,n,r,a)}}return function(){return t.apply(e,arguments)}};d.iteratee=function(t,e,i){return null==t?d.identity:d.isFunction(t)?p(t,e,i):d.isObject(t)?d.matches(t):d.property(t)},d.each=d.forEach=function(t,e,i){if(null==t)return t;e=p(e,i);var n,r=t.length;if(r===+r)for(n=0;r>n;n++)e(t[n],n,t);else{var a=d.keys(t);for(n=0,r=a.length;r>n;n++)e(t[a[n]],a[n],t)}return t},d.map=d.collect=function(t,e,i){if(null==t)return[];e=d.iteratee(e,i);for(var n,r=t.length!==+t.length&&d.keys(t),a=(r||t).length,s=Array(a),o=0;a>o;o++)n=r?r[o]:o,s[o]=e(t[n],n,t);return s};var m="Reduce of empty array with no initial value";d.reduce=d.foldl=d.inject=function(t,e,i,n){null==t&&(t=[]),e=p(e,n,4);var r,a=t.length!==+t.length&&d.keys(t),s=(a||t).length,o=0;if(arguments.length<3){if(!s)throw new TypeError(m);i=t[a?a[o++]:o++]}for(;s>o;o++)r=a?a[o]:o,i=e(i,t[r],r,t);return i},d.reduceRight=d.foldr=function(t,e,i,n){null==t&&(t=[]),e=p(e,n,4);var r,a=t.length!==+t.length&&d.keys(t),s=(a||t).length;if(arguments.length<3){if(!s)throw new TypeError(m);i=t[a?a[--s]:--s]}for(;s--;)r=a?a[s]:s,i=e(i,t[r],r,t);return i},d.find=d.detect=function(t,e,i){var n;return e=d.iteratee(e,i),d.some(t,function(t,i,r){return e(t,i,r)?(n=t,!0):void 0}),n},d.filter=d.select=function(t,e,i){var n=[];return null==t?n:(e=d.iteratee(e,i),d.each(t,function(t,i,r){e(t,i,r)&&n.push(t)}),n)},d.reject=function(t,e,i){return d.filter(t,d.negate(d.iteratee(e)),i)},d.every=d.all=function(t,e,i){if(null==t)return!0;e=d.iteratee(e,i);var n,r,a=t.length!==+t.length&&d.keys(t),s=(a||t).length;for(n=0;s>n;n++)if(r=a?a[n]:n,!e(t[r],r,t))return!1;return!0},d.some=d.any=function(t,e,i){if(null==t)return!1;e=d.iteratee(e,i);var n,r,a=t.length!==+t.length&&d.keys(t),s=(a||t).length;for(n=0;s>n;n++)if(r=a?a[n]:n,e(t[r],r,t))return!0;return!1},d.contains=d.include=function(t,e){return null==t?!1:(t.length!==+t.length&&(t=d.values(t)),d.indexOf(t,e)>=0)},d.invoke=function(t,e){var i=s.call(arguments,2),n=d.isFunction(e);return d.map(t,function(t){return(n?e:t[e]).apply(t,i)})},d.pluck=function(t,e){return d.map(t,d.property(e))},d.where=function(t,e){return d.filter(t,d.matches(e))},d.findWhere=function(t,e){return d.find(t,d.matches(e))},d.max=function(t,e,i){var n,r,a=-1/0,s=-1/0;if(null==e&&null!=t){t=t.length===+t.length?t:d.values(t);for(var o=0,u=t.length;u>o;o++)n=t[o],n>a&&(a=n)}else e=d.iteratee(e,i),d.each(t,function(t,i,n){r=e(t,i,n),(r>s||r===-1/0&&a===-1/0)&&(a=t,s=r)});return a},d.min=function(t,e,i){var n,r,a=1/0,s=1/0;if(null==e&&null!=t){t=t.length===+t.length?t:d.values(t);for(var o=0,u=t.length;u>o;o++)n=t[o],a>n&&(a=n)}else e=d.iteratee(e,i),d.each(t,function(t,i,n){r=e(t,i,n),(s>r||1/0===r&&1/0===a)&&(a=t,s=r)});return a},d.shuffle=function(t){for(var e,i=t&&t.length===+t.length?t:d.values(t),n=i.length,r=Array(n),a=0;n>a;a++)e=d.random(0,a),e!==a&&(r[a]=r[e]),r[e]=i[a];return r},d.sample=function(t,e,i){return null==e||i?(t.length!==+t.length&&(t=d.values(t)),t[d.random(t.length-1)]):d.shuffle(t).slice(0,Math.max(0,e))},d.sortBy=function(t,e,i){return e=d.iteratee(e,i),d.pluck(d.map(t,function(t,i,n){return{value:t,index:i,criteria:e(t,i,n)}}).sort(function(t,e){var i=t.criteria,n=e.criteria;if(i!==n){if(i>n||void 0===i)return 1;if(n>i||void 0===n)return-1}return t.index-e.index}),"value")};var g=function(t){return function(e,i,n){var r={};return i=d.iteratee(i,n),d.each(e,function(n,a){var s=i(n,a,e);t(r,n,s)}),r}};d.groupBy=g(function(t,e,i){d.has(t,i)?t[i].push(e):t[i]=[e]}),d.indexBy=g(function(t,e,i){t[i]=e}),d.countBy=g(function(t,e,i){d.has(t,i)?t[i]++:t[i]=1}),d.sortedIndex=function(t,e,i,n){i=d.iteratee(i,n,1);for(var r=i(e),a=0,s=t.length;s>a;){var o=a+s>>>1;i(t[o])<r?a=o+1:s=o}return a},d.toArray=function(t){return t?d.isArray(t)?s.call(t):t.length===+t.length?d.map(t,d.identity):d.values(t):[]},d.size=function(t){return null==t?0:t.length===+t.length?t.length:d.keys(t).length},d.partition=function(t,e,i){e=d.iteratee(e,i);var n=[],r=[];return d.each(t,function(t,i,a){(e(t,i,a)?n:r).push(t)}),[n,r]},d.first=d.head=d.take=function(t,e,i){return null==t?void 0:null==e||i?t[0]:0>e?[]:s.call(t,0,e)},d.initial=function(t,e,i){return s.call(t,0,Math.max(0,t.length-(null==e||i?1:e)))},d.last=function(t,e,i){return null==t?void 0:null==e||i?t[t.length-1]:s.call(t,Math.max(t.length-e,0))},d.rest=d.tail=d.drop=function(t,e,i){return s.call(t,null==e||i?1:e)},d.compact=function(t){return d.filter(t,d.identity)};var v=function(t,e,i,n){if(e&&d.every(t,d.isArray))return o.apply(n,t);for(var r=0,s=t.length;s>r;r++){var u=t[r];d.isArray(u)||d.isArguments(u)?e?a.apply(n,u):v(u,e,i,n):i||n.push(u)}return n};d.flatten=function(t,e){return v(t,e,!1,[])},d.without=function(t){return d.difference(t,s.call(arguments,1))},d.uniq=d.unique=function(t,e,i,n){if(null==t)return[];d.isBoolean(e)||(n=i,i=e,e=!1),null!=i&&(i=d.iteratee(i,n));for(var r=[],a=[],s=0,o=t.length;o>s;s++){var u=t[s];if(e)s&&a===u||r.push(u),a=u;else if(i){var l=i(u,s,t);d.indexOf(a,l)<0&&(a.push(l),r.push(u))}else d.indexOf(r,u)<0&&r.push(u)}return r},d.union=function(){return d.uniq(v(arguments,!0,!0,[]))},d.intersection=function(t){if(null==t)return[];for(var e=[],i=arguments.length,n=0,r=t.length;r>n;n++){var a=t[n];if(!d.contains(e,a)){for(var s=1;i>s&&d.contains(arguments[s],a);s++);s===i&&e.push(a)}}return e},d.difference=function(t){var e=v(s.call(arguments,1),!0,!0,[]);return d.filter(t,function(t){return!d.contains(e,t)})},d.zip=function(t){if(null==t)return[];for(var e=d.max(arguments,"length").length,i=Array(e),n=0;e>n;n++)i[n]=d.pluck(arguments,n);return i},d.object=function(t,e){if(null==t)return{};for(var i={},n=0,r=t.length;r>n;n++)e?i[t[n]]=e[n]:i[t[n][0]]=t[n][1];return i},d.indexOf=function(t,e,i){if(null==t)return-1;var n=0,r=t.length;if(i){if("number"!=typeof i)return n=d.sortedIndex(t,e),t[n]===e?n:-1;n=0>i?Math.max(0,r+i):i}for(;r>n;n++)if(t[n]===e)return n;return-1},d.lastIndexOf=function(t,e,i){if(null==t)return-1;var n=t.length;for("number"==typeof i&&(n=0>i?n+i+1:Math.min(n,i+1));--n>=0;)if(t[n]===e)return n;return-1},d.range=function(t,e,i){arguments.length<=1&&(e=t||0,t=0),i=i||1;for(var n=Math.max(Math.ceil((e-t)/i),0),r=Array(n),a=0;n>a;a++,t+=i)r[a]=t;return r};var y=function(){};d.bind=function(t,e){var i,n;if(f&&t.bind===f)return f.apply(t,s.call(arguments,1));if(!d.isFunction(t))throw new TypeError("Bind must be called on a function");return i=s.call(arguments,2),n=function(){if(!(this instanceof n))return t.apply(e,i.concat(s.call(arguments)));y.prototype=t.prototype;var r=new y;y.prototype=null;var a=t.apply(r,i.concat(s.call(arguments)));return d.isObject(a)?a:r}},d.partial=function(t){var e=s.call(arguments,1);return function(){for(var i=0,n=e.slice(),r=0,a=n.length;a>r;r++)n[r]===d&&(n[r]=arguments[i++]);for(;i<arguments.length;)n.push(arguments[i++]);return t.apply(this,n)}},d.bindAll=function(t){var e,i,n=arguments.length;if(1>=n)throw new Error("bindAll must be passed function names");for(e=1;n>e;e++)i=arguments[e],t[i]=d.bind(t[i],t);return t},d.memoize=function(t,e){var i=function(n){var r=i.cache,a=e?e.apply(this,arguments):n;return d.has(r,a)||(r[a]=t.apply(this,arguments)),r[a]};return i.cache={},i},d.delay=function(t,e){var i=s.call(arguments,2);return setTimeout(function(){return t.apply(null,i)},e)},d.defer=function(t){return d.delay.apply(d,[t,1].concat(s.call(arguments,1)))},d.throttle=function(t,e,i){var n,r,a,s=null,o=0;i||(i={});var u=function(){o=i.leading===!1?0:d.now(),s=null,a=t.apply(n,r),s||(n=r=null)};return function(){var l=d.now();o||i.leading!==!1||(o=l);var c=e-(l-o);return n=this,r=arguments,0>=c||c>e?(clearTimeout(s),s=null,o=l,a=t.apply(n,r),s||(n=r=null)):s||i.trailing===!1||(s=setTimeout(u,c)),a}},d.debounce=function(t,e,i){var n,r,a,s,o,u=function(){var l=d.now()-s;e>l&&l>0?n=setTimeout(u,e-l):(n=null,i||(o=t.apply(a,r),n||(a=r=null)))};return function(){a=this,r=arguments,s=d.now();var l=i&&!n;return n||(n=setTimeout(u,e)),l&&(o=t.apply(a,r),a=r=null),o}},d.wrap=function(t,e){return d.partial(e,t)},d.negate=function(t){return function(){return!t.apply(this,arguments)}},d.compose=function(){var t=arguments,e=t.length-1;return function(){for(var i=e,n=t[e].apply(this,arguments);i--;)n=t[i].call(this,n);return n}},d.after=function(t,e){return function(){return--t<1?e.apply(this,arguments):void 0}},d.before=function(t,e){var i;return function(){return--t>0?i=e.apply(this,arguments):e=null,i}},d.once=d.partial(d.before,2),d.keys=function(t){if(!d.isObject(t))return[];if(h)return h(t);var e=[];for(var i in t)d.has(t,i)&&e.push(i);return e},d.values=function(t){for(var e=d.keys(t),i=e.length,n=Array(i),r=0;i>r;r++)n[r]=t[e[r]];return n},d.pairs=function(t){for(var e=d.keys(t),i=e.length,n=Array(i),r=0;i>r;r++)n[r]=[e[r],t[e[r]]];return n},d.invert=function(t){for(var e={},i=d.keys(t),n=0,r=i.length;r>n;n++)e[t[i[n]]]=i[n];return e},d.functions=d.methods=function(t){var e=[];for(var i in t)d.isFunction(t[i])&&e.push(i);return e.sort()},d.extend=function(t){if(!d.isObject(t))return t;for(var e,i,n=1,r=arguments.length;r>n;n++){e=arguments[n];for(i in e)l.call(e,i)&&(t[i]=e[i])}return t},d.pick=function(t,e,i){var n,r={};if(null==t)return r;if(d.isFunction(e)){e=p(e,i);for(n in t){var a=t[n];e(a,n,t)&&(r[n]=a)}}else{var u=o.apply([],s.call(arguments,1));t=new Object(t);for(var l=0,c=u.length;c>l;l++)n=u[l],n in t&&(r[n]=t[n])}return r},d.omit=function(t,e,i){if(d.isFunction(e))e=d.negate(e);else{var n=d.map(o.apply([],s.call(arguments,1)),String);e=function(t,e){return!d.contains(n,e)}}return d.pick(t,e,i)},d.defaults=function(t){if(!d.isObject(t))return t;for(var e=1,i=arguments.length;i>e;e++){var n=arguments[e];for(var r in n)void 0===t[r]&&(t[r]=n[r])}return t},d.clone=function(t){return d.isObject(t)?d.isArray(t)?t.slice():d.extend({},t):t},d.tap=function(t,e){return e(t),t};var b=function(t,e,i,n){if(t===e)return 0!==t||1/t===1/e;if(null==t||null==e)return t===e;t instanceof d&&(t=t._wrapped),e instanceof d&&(e=e._wrapped);var r=u.call(t);if(r!==u.call(e))return!1;switch(r){case"[object RegExp]":case"[object String]":return""+t==""+e;case"[object Number]":return+t!==+t?+e!==+e:0===+t?1/+t===1/e:+t===+e;case"[object Date]":case"[object Boolean]":return+t===+e}if("object"!=typeof t||"object"!=typeof e)return!1;for(var a=i.length;a--;)if(i[a]===t)return n[a]===e;var s=t.constructor,o=e.constructor;if(s!==o&&"constructor"in t&&"constructor"in e&&!(d.isFunction(s)&&s instanceof s&&d.isFunction(o)&&o instanceof o))return!1;i.push(t),n.push(e);var l,c;if("[object Array]"===r){if(l=t.length,c=l===e.length)for(;l--&&(c=b(t[l],e[l],i,n)););}else{var h,f=d.keys(t);if(l=f.length,c=d.keys(e).length===l)for(;l--&&(h=f[l],c=d.has(e,h)&&b(t[h],e[h],i,n)););}return i.pop(),n.pop(),c};d.isEqual=function(t,e){return b(t,e,[],[])},d.isEmpty=function(t){if(null==t)return!0;if(d.isArray(t)||d.isString(t)||d.isArguments(t))return 0===t.length;for(var e in t)if(d.has(t,e))return!1;return!0},d.isElement=function(t){return!(!t||1!==t.nodeType)},d.isArray=c||function(t){return"[object Array]"===u.call(t)},d.isObject=function(t){var e=typeof t;return"function"===e||"object"===e&&!!t},d.each(["Arguments","Function","String","Number","Date","RegExp"],function(t){d["is"+t]=function(e){return u.call(e)==="[object "+t+"]"}}),d.isArguments(arguments)||(d.isArguments=function(t){return d.has(t,"callee")}),"function"!=typeof/./&&(d.isFunction=function(t){return"function"==typeof t||!1}),d.isFinite=function(t){return isFinite(t)&&!isNaN(parseFloat(t))},d.isNaN=function(t){return d.isNumber(t)&&t!==+t},d.isBoolean=function(t){return t===!0||t===!1||"[object Boolean]"===u.call(t)},d.isNull=function(t){return null===t},d.isUndefined=function(t){return void 0===t},d.has=function(t,e){return null!=t&&l.call(t,e)},d.noConflict=function(){return t._=e,this},d.identity=function(t){return t},d.constant=function(t){return function(){return t}},d.noop=function(){},d.property=function(t){return function(e){return e[t]}},d.matches=function(t){var e=d.pairs(t),i=e.length;return function(t){if(null==t)return!i;t=new Object(t);for(var n=0;i>n;n++){var r=e[n],a=r[0];if(r[1]!==t[a]||!(a in t))return!1}return!0}},d.times=function(t,e,i){var n=Array(Math.max(0,t));e=p(e,i,1);for(var r=0;t>r;r++)n[r]=e(r);return n},d.random=function(t,e){return null==e&&(e=t,t=0),t+Math.floor(Math.random()*(e-t+1))},d.now=Date.now||function(){return(new Date).getTime()};var _={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},w=d.invert(_),k=function(t){var e=function(e){return t[e]},i="(?:"+d.keys(t).join("|")+")",n=RegExp(i),r=RegExp(i,"g");return function(t){return t=null==t?"":""+t,n.test(t)?t.replace(r,e):t}};d.escape=k(_),d.unescape=k(w),d.result=function(t,e){if(null==t)return void 0;var i=t[e];return d.isFunction(i)?t[e]():i};var x=0;d.uniqueId=function(t){var e=++x+"";return t?t+e:e},d.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var T=/(.)^/,P={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},E=/\\|'|\r|\n|\u2028|\u2029/g,j=function(t){return"\\"+P[t]};d.template=function(t,e,i){!e&&i&&(e=i),e=d.defaults({},e,d.templateSettings);var n=RegExp([(e.escape||T).source,(e.interpolate||T).source,(e.evaluate||T).source].join("|")+"|$","g"),r=0,a="__p+='";t.replace(n,function(e,i,n,s,o){return a+=t.slice(r,o).replace(E,j),r=o+e.length,i?a+="'+\n((__t=("+i+"))==null?'':_.escape(__t))+\n'":n?a+="'+\n((__t=("+n+"))==null?'':__t)+\n'":s&&(a+="';\n"+s+"\n__p+='"),e}),a+="';\n",e.variable||(a="with(obj||{}){\n"+a+"}\n"),a="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+a+"return __p;\n";try{var s=new Function(e.variable||"obj","_",a)}catch(o){throw o.source=a,o}var u=function(t){return s.call(this,t,d)},l=e.variable||"obj";return u.source="function("+l+"){\n"+a+"}",u},d.chain=function(t){var e=d(t);return e._chain=!0,e};var A=function(t){return this._chain?d(t).chain():t};d.mixin=function(t){d.each(d.functions(t),function(e){var i=d[e]=t[e];d.prototype[e]=function(){var t=[this._wrapped];return a.apply(t,arguments),A.call(this,i.apply(d,t))}})},d.mixin(d),d.each(["pop","push","reverse","shift","sort","splice","unshift"],function(t){var e=i[t];d.prototype[t]=function(){var i=this._wrapped;return e.apply(i,arguments),"shift"!==t&&"splice"!==t||0!==i.length||delete i[0],A.call(this,i)}}),d.each(["concat","join","slice"],function(t){var e=i[t];d.prototype[t]=function(){return A.call(this,e.apply(this._wrapped,arguments))}}),d.prototype.value=function(){return this._wrapped},"function"==typeof define&&define.amd&&define("underscore",[],function(){return d})}).call(this),function(t,e){if("function"==typeof define&&define.amd)define(["underscore","jquery","exports"],function(i,n,r){t.Backbone=e(t,r,i,n)});else if("undefined"!=typeof exports){var i=require("underscore");e(t,exports,i)}else t.Backbone=e(t,{},t._,t.jQuery||t.Zepto||t.ender||t.$)}(this,function(t,e,i,n){var r=t.Backbone,a=[],s=a.push,o=a.slice,u=a.splice;e.VERSION="1.1.2",e.$=n,e.noConflict=function(){return t.Backbone=r,this},e.emulateHTTP=!1,e.emulateJSON=!1;var l=e.Events={on:function(t,e,i){if(!h(this,"on",t,[e,i])||!e)return this;this._events||(this._events={});var n=this._events[t]||(this._events[t]=[]);return n.push({callback:e,context:i,ctx:i||this}),this},once:function(t,e,n){if(!h(this,"once",t,[e,n])||!e)return this;var r=this,a=i.once(function(){r.off(t,a),e.apply(this,arguments)});return a._callback=e,this.on(t,a,n)},off:function(t,e,n){var r,a,s,o,u,l,c,f;if(!this._events||!h(this,"off",t,[e,n]))return this;if(!t&&!e&&!n)return this._events=void 0,this;for(o=t?[t]:i.keys(this._events),u=0,l=o.length;l>u;u++)if(t=o[u],s=this._events[t]){if(this._events[t]=r=[],e||n)for(c=0,f=s.length;f>c;c++)a=s[c],(e&&e!==a.callback&&e!==a.callback._callback||n&&n!==a.context)&&r.push(a);r.length||delete this._events[t]}return this},trigger:function(t){if(!this._events)return this;var e=o.call(arguments,1);if(!h(this,"trigger",t,e))return this;var i=this._events[t],n=this._events.all;return i&&f(i,e),n&&f(n,arguments),this},stopListening:function(t,e,n){var r=this._listeningTo;if(!r)return this;var a=!e&&!n;n||"object"!=typeof e||(n=this),t&&((r={})[t._listenId]=t);for(var s in r)t=r[s],t.off(e,n,this),(a||i.isEmpty(t._events))&&delete this._listeningTo[s];return this}},c=/\s+/,h=function(t,e,i,n){if(!i)return!0;if("object"==typeof i){for(var r in i)t[e].apply(t,[r,i[r]].concat(n));return!1}if(c.test(i)){for(var a=i.split(c),s=0,o=a.length;o>s;s++)t[e].apply(t,[a[s]].concat(n));return!1}return!0},f=function(t,e){var i,n=-1,r=t.length,a=e[0],s=e[1],o=e[2];switch(e.length){case 0:for(;++n<r;)(i=t[n]).callback.call(i.ctx);return;case 1:for(;++n<r;)(i=t[n]).callback.call(i.ctx,a);return;case 2:for(;++n<r;)(i=t[n]).callback.call(i.ctx,a,s);return;case 3:for(;++n<r;)(i=t[n]).callback.call(i.ctx,a,s,o);return;default:for(;++n<r;)(i=t[n]).callback.apply(i.ctx,e);return}},d={listenTo:"on",listenToOnce:"once"};i.each(d,function(t,e){l[e]=function(e,n,r){var a=this._listeningTo||(this._listeningTo={}),s=e._listenId||(e._listenId=i.uniqueId("l"));return a[s]=e,r||"object"!=typeof n||(r=this),e[t](n,r,this),this}}),l.bind=l.on,l.unbind=l.off,i.extend(e,l);var p=e.Model=function(t,e){var n=t||{};e||(e={}),this.cid=i.uniqueId("c"),this.attributes={},e.collection&&(this.collection=e.collection),e.parse&&(n=this.parse(n,e)||{}),n=i.defaults({},n,i.result(this,"defaults")),this.set(n,e),this.changed={},this.initialize.apply(this,arguments)};i.extend(p.prototype,l,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(t){return i.clone(this.attributes)},sync:function(){return e.sync.apply(this,arguments)},get:function(t){return this.attributes[t]},escape:function(t){return i.escape(this.get(t))},has:function(t){return null!=this.get(t)},set:function(t,e,n){var r,a,s,o,u,l,c,h;if(null==t)return this;if("object"==typeof t?(a=t,n=e):(a={})[t]=e,n||(n={}),!this._validate(a,n))return!1;s=n.unset,u=n.silent,o=[],l=this._changing,this._changing=!0,l||(this._previousAttributes=i.clone(this.attributes),this.changed={}),h=this.attributes,c=this._previousAttributes,this.idAttribute in a&&(this.id=a[this.idAttribute]);for(r in a)e=a[r],i.isEqual(h[r],e)||o.push(r),i.isEqual(c[r],e)?delete this.changed[r]:this.changed[r]=e,s?delete h[r]:h[r]=e;if(!u){o.length&&(this._pending=n);for(var f=0,d=o.length;d>f;f++)this.trigger("change:"+o[f],this,h[o[f]],n)}if(l)return this;if(!u)for(;this._pending;)n=this._pending,this._pending=!1,this.trigger("change",this,n);return this._pending=!1,this._changing=!1,this},unset:function(t,e){return this.set(t,void 0,i.extend({},e,{unset:!0}))},clear:function(t){var e={};for(var n in this.attributes)e[n]=void 0;return this.set(e,i.extend({},t,{unset:!0}))},hasChanged:function(t){return null==t?!i.isEmpty(this.changed):i.has(this.changed,t)},changedAttributes:function(t){if(!t)return this.hasChanged()?i.clone(this.changed):!1;var e,n=!1,r=this._changing?this._previousAttributes:this.attributes;for(var a in t)i.isEqual(r[a],e=t[a])||((n||(n={}))[a]=e);return n},previous:function(t){return null!=t&&this._previousAttributes?this._previousAttributes[t]:null},previousAttributes:function(){return i.clone(this._previousAttributes)},fetch:function(t){t=t?i.clone(t):{},void 0===t.parse&&(t.parse=!0);var e=this,n=t.success;return t.success=function(i){return e.set(e.parse(i,t),t)?(n&&n(e,i,t),void e.trigger("sync",e,i,t)):!1},R(this,t),this.sync("read",this,t)},save:function(t,e,n){var r,a,s,o=this.attributes;if(null==t||"object"==typeof t?(r=t,n=e):(r={})[t]=e,n=i.extend({validate:!0},n),r&&!n.wait){if(!this.set(r,n))return!1}else if(!this._validate(r,n))return!1;r&&n.wait&&(this.attributes=i.extend({},o,r)),void 0===n.parse&&(n.parse=!0);var u=this,l=n.success;return n.success=function(t){u.attributes=o;var e=u.parse(t,n);return n.wait&&(e=i.extend(r||{},e)),i.isObject(e)&&!u.set(e,n)?!1:(l&&l(u,t,n),void u.trigger("sync",u,t,n))},R(this,n),a=this.isNew()?"create":n.patch?"patch":"update","patch"===a&&(n.attrs=r),s=this.sync(a,this,n),r&&n.wait&&(this.attributes=o),s},destroy:function(t){t=t?i.clone(t):{};var e=this,n=t.success,r=function(){e.trigger("destroy",e,e.collection,t)};if(t.success=function(i){(t.wait||e.isNew())&&r(),n&&n(e,i,t),e.isNew()||e.trigger("sync",e,i,t)},this.isNew())return t.success(),!1;R(this,t);var a=this.sync("delete",this,t);return t.wait||r(),a},url:function(){var t=i.result(this,"urlRoot")||i.result(this.collection,"url")||z();return this.isNew()?t:t.replace(/([^\/])$/,"$1/")+encodeURIComponent(this.id)},parse:function(t,e){return t},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(t){return this._validate({},i.extend(t||{},{validate:!0}))},_validate:function(t,e){if(!e.validate||!this.validate)return!0;t=i.extend({},this.attributes,t);var n=this.validationError=this.validate(t,e)||null;return n?(this.trigger("invalid",this,n,i.extend(e,{validationError:n})),!1):!0}});var m=["keys","values","pairs","invert","pick","omit"];i.each(m,function(t){p.prototype[t]=function(){var e=o.call(arguments);return e.unshift(this.attributes),i[t].apply(i,e)}});var g=e.Collection=function(t,e){e||(e={}),e.model&&(this.model=e.model),void 0!==e.comparator&&(this.comparator=e.comparator),this._reset(),this.initialize.apply(this,arguments),t&&this.reset(t,i.extend({silent:!0},e))},v={add:!0,remove:!0,merge:!0},y={add:!0,remove:!1};i.extend(g.prototype,l,{model:p,initialize:function(){},toJSON:function(t){return this.map(function(e){return e.toJSON(t)})},sync:function(){return e.sync.apply(this,arguments)},add:function(t,e){return this.set(t,i.extend({merge:!1},e,y))},remove:function(t,e){var n=!i.isArray(t);t=n?[t]:i.clone(t),e||(e={});var r,a,s,o;for(r=0,a=t.length;a>r;r++)o=t[r]=this.get(t[r]),o&&(delete this._byId[o.id],delete this._byId[o.cid],s=this.indexOf(o),this.models.splice(s,1),this.length--,e.silent||(e.index=s,o.trigger("remove",o,this,e)),this._removeReference(o,e));return n?t[0]:t},set:function(t,e){e=i.defaults({},e,v),e.parse&&(t=this.parse(t,e));var n=!i.isArray(t);t=n?t?[t]:[]:i.clone(t);var r,a,s,o,u,l,c,h=e.at,f=this.model,d=this.comparator&&null==h&&e.sort!==!1,m=i.isString(this.comparator)?this.comparator:null,g=[],y=[],b={},_=e.add,w=e.merge,k=e.remove,x=!d&&_&&k?[]:!1;for(r=0,a=t.length;a>r;r++){if(u=t[r]||{},s=u instanceof p?o=u:u[f.prototype.idAttribute||"id"],l=this.get(s))k&&(b[l.cid]=!0),w&&(u=u===o?o.attributes:u,e.parse&&(u=l.parse(u,e)),l.set(u,e),d&&!c&&l.hasChanged(m)&&(c=!0)),t[r]=l;else if(_){if(o=t[r]=this._prepareModel(u,e),!o)continue;g.push(o),this._addReference(o,e)}o=l||o,!x||!o.isNew()&&b[o.id]||x.push(o),b[o.id]=!0}if(k){for(r=0,a=this.length;a>r;++r)b[(o=this.models[r]).cid]||y.push(o);y.length&&this.remove(y,e)}if(g.length||x&&x.length)if(d&&(c=!0),this.length+=g.length,null!=h)for(r=0,a=g.length;a>r;r++)this.models.splice(h+r,0,g[r]);else{x&&(this.models.length=0);var T=x||g;for(r=0,a=T.length;a>r;r++)this.models.push(T[r])}if(c&&this.sort({silent:!0}),!e.silent){for(r=0,a=g.length;a>r;r++)(o=g[r]).trigger("add",o,this,e);(c||x&&x.length)&&this.trigger("sort",this,e)}return n?t[0]:t},reset:function(t,e){e||(e={});for(var n=0,r=this.models.length;r>n;n++)this._removeReference(this.models[n],e);return e.previousModels=this.models,this._reset(),t=this.add(t,i.extend({silent:!0},e)),e.silent||this.trigger("reset",this,e),t},push:function(t,e){return this.add(t,i.extend({at:this.length},e))},pop:function(t){var e=this.at(this.length-1);return this.remove(e,t),e},unshift:function(t,e){return this.add(t,i.extend({at:0},e))},shift:function(t){var e=this.at(0);return this.remove(e,t),e},slice:function(){return o.apply(this.models,arguments)},get:function(t){return null==t?void 0:this._byId[t]||this._byId[t.id]||this._byId[t.cid]},at:function(t){return this.models[t]},where:function(t,e){return i.isEmpty(t)?e?void 0:[]:this[e?"find":"filter"](function(e){for(var i in t)if(t[i]!==e.get(i))return!1;return!0})},findWhere:function(t){return this.where(t,!0)},sort:function(t){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return t||(t={}),i.isString(this.comparator)||1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort(i.bind(this.comparator,this)),t.silent||this.trigger("sort",this,t),this},pluck:function(t){return i.invoke(this.models,"get",t)},fetch:function(t){t=t?i.clone(t):{},void 0===t.parse&&(t.parse=!0);var e=t.success,n=this;return t.success=function(i){var r=t.reset?"reset":"set";n[r](i,t),e&&e(n,i,t),n.trigger("sync",n,i,t)},R(this,t),this.sync("read",this,t)},create:function(t,e){if(e=e?i.clone(e):{},!(t=this._prepareModel(t,e)))return!1;e.wait||this.add(t,e);var n=this,r=e.success;return e.success=function(t,i){e.wait&&n.add(t,e),r&&r(t,i,e)},t.save(null,e),t},parse:function(t,e){return t},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(t,e){if(t instanceof p)return t;e=e?i.clone(e):{},e.collection=this;var n=new this.model(t,e);return n.validationError?(this.trigger("invalid",this,n.validationError,e),!1):n},_addReference:function(t,e){this._byId[t.cid]=t,null!=t.id&&(this._byId[t.id]=t),t.collection||(t.collection=this),t.on("all",this._onModelEvent,this)},_removeReference:function(t,e){this===t.collection&&delete t.collection,t.off("all",this._onModelEvent,this)},_onModelEvent:function(t,e,i,n){("add"!==t&&"remove"!==t||i===this)&&("destroy"===t&&this.remove(e,n),e&&t==="change:"+e.idAttribute&&(delete this._byId[e.previous(e.idAttribute)],null!=e.id&&(this._byId[e.id]=e)),this.trigger.apply(this,arguments))}});var b=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","difference","indexOf","shuffle","lastIndexOf","isEmpty","chain","sample"];i.each(b,function(t){g.prototype[t]=function(){var e=o.call(arguments);return e.unshift(this.models),i[t].apply(i,e)}});var _=["groupBy","countBy","sortBy","indexBy"];i.each(_,function(t){g.prototype[t]=function(e,n){var r=i.isFunction(e)?e:function(t){return t.get(e)};return i[t](this.models,r,n)}});var w=e.View=function(t){this.cid=i.uniqueId("view"),t||(t={}),i.extend(this,i.pick(t,x)),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},k=/^(\S+)\s*(.*)$/,x=["model","collection","el","id","attributes","className","tagName","events"];i.extend(w.prototype,l,{tagName:"div",$:function(t){return this.$el.find(t)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},setElement:function(t,i){return this.$el&&this.undelegateEvents(),this.$el=t instanceof e.$?t:e.$(t),this.el=this.$el[0],i!==!1&&this.delegateEvents(),this},delegateEvents:function(t){if(!t&&!(t=i.result(this,"events")))return this;this.undelegateEvents();for(var e in t){var n=t[e];if(i.isFunction(n)||(n=this[t[e]]),n){var r=e.match(k),a=r[1],s=r[2];n=i.bind(n,this),a+=".delegateEvents"+this.cid,""===s?this.$el.on(a,n):this.$el.on(a,s,n)}}return this},undelegateEvents:function(){return this.$el.off(".delegateEvents"+this.cid),this},_ensureElement:function(){if(this.el)this.setElement(i.result(this,"el"),!1);else{var t=i.extend({},i.result(this,"attributes"));this.id&&(t.id=i.result(this,"id")),this.className&&(t["class"]=i.result(this,"className"));var n=e.$("<"+i.result(this,"tagName")+">").attr(t);this.setElement(n,!1)}}}),e.sync=function(t,n,r){var a=P[t];i.defaults(r||(r={}),{emulateHTTP:e.emulateHTTP,emulateJSON:e.emulateJSON});var s={type:a,dataType:"json"};if(r.url||(s.url=i.result(n,"url")||z()),null!=r.data||!n||"create"!==t&&"update"!==t&&"patch"!==t||(s.contentType="application/json",s.data=JSON.stringify(r.attrs||n.toJSON(r))),r.emulateJSON&&(s.contentType="application/x-www-form-urlencoded",s.data=s.data?{model:s.data}:{}),r.emulateHTTP&&("PUT"===a||"DELETE"===a||"PATCH"===a)){s.type="POST",r.emulateJSON&&(s.data._method=a);var o=r.beforeSend;r.beforeSend=function(t){return t.setRequestHeader("X-HTTP-Method-Override",a),o?o.apply(this,arguments):void 0}}"GET"===s.type||r.emulateJSON||(s.processData=!1),"PATCH"===s.type&&T&&(s.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")});var u=r.xhr=e.ajax(i.extend(s,r));return n.trigger("request",n,u,r),u};var T=!("undefined"==typeof window||!window.ActiveXObject||window.XMLHttpRequest&&(new XMLHttpRequest).dispatchEvent),P={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};e.ajax=function(){return e.$.ajax.apply(e.$,arguments)};var $=e.Router=function(t){t||(t={}),t.routes&&(this.routes=t.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},E=/\((.*?)\)/g,j=/(\(\?)?:\w+/g,A=/\*\w+/g,M=/[\-{}\[\]+?.,\\\^$|#\s]/g;i.extend($.prototype,l,{initialize:function(){},route:function(t,n,r){i.isRegExp(t)||(t=this._routeToRegExp(t)),i.isFunction(n)&&(r=n,n=""),r||(r=this[n]);var a=this;return e.history.route(t,function(i){var s=a._extractParameters(t,i);a.execute(r,s),a.trigger.apply(a,["route:"+n].concat(s)),a.trigger("route",n,s),e.history.trigger("route",a,n,s)}),this},execute:function(t,e){t&&t.apply(this,e)},navigate:function(t,i){return e.history.navigate(t,i),this},_bindRoutes:function(){if(this.routes){this.routes=i.result(this,"routes");for(var t,e=i.keys(this.routes);null!=(t=e.pop());)this.route(t,this.routes[t])}},_routeToRegExp:function(t){return t=t.replace(M,"\\$&").replace(E,"(?:$1)?").replace(j,function(t,e){return e?t:"([^/?]+)"}).replace(A,"([^?]*?)"),new RegExp("^"+t+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(t,e){var n=t.exec(e).slice(1);return i.map(n,function(t,e){return e===n.length-1?t||null:t?decodeURIComponent(t):null})}});var S=e.History=function(){this.handlers=[],i.bindAll(this,"checkUrl"),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},C=/^[#\/]|\s+$/g,I=/^\/+|\/+$/g,O=/msie [\w.]+/,B=/\/$/,N=/#.*$/;S.started=!1,i.extend(S.prototype,l,{interval:50,atRoot:function(){return this.location.pathname.replace(/[^\/]$/,"$&/")===this.root},getHash:function(t){var e=(t||this).location.href.match(/#(.*)$/);return e?e[1]:""},getFragment:function(t,e){if(null==t)if(this._hasPushState||!this._wantsHashChange||e){t=decodeURI(this.location.pathname+this.location.search);var i=this.root.replace(B,"");t.indexOf(i)||(t=t.slice(i.length))}else t=this.getHash();return t.replace(C,"")},start:function(t){if(S.started)throw new Error("Backbone.history has already been started");S.started=!0,this.options=i.extend({root:"/"},this.options,t),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var n=this.getFragment(),r=document.documentMode,a=O.exec(navigator.userAgent.toLowerCase())&&(!r||7>=r);if(this.root=("/"+this.root+"/").replace(I,"/"),a&&this._wantsHashChange){var s=e.$('<iframe src="javascript:0" tabindex="-1">');
this.iframe=s.hide().appendTo("body")[0].contentWindow,this.navigate(n)}this._hasPushState?e.$(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!a?e.$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=n;var o=this.location;if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot())return this.fragment=this.getFragment(null,!0),this.location.replace(this.root+"#"+this.fragment),!0;this._hasPushState&&this.atRoot()&&o.hash&&(this.fragment=this.getHash().replace(C,""),this.history.replaceState({},document.title,this.root+this.fragment))}return this.options.silent?void 0:this.loadUrl()},stop:function(){e.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),this._checkUrlInterval&&clearInterval(this._checkUrlInterval),S.started=!1},route:function(t,e){this.handlers.unshift({route:t,callback:e})},checkUrl:function(t){var e=this.getFragment();return e===this.fragment&&this.iframe&&(e=this.getFragment(this.getHash(this.iframe))),e===this.fragment?!1:(this.iframe&&this.navigate(e),void this.loadUrl())},loadUrl:function(t){return t=this.fragment=this.getFragment(t),i.any(this.handlers,function(e){return e.route.test(t)?(e.callback(t),!0):void 0})},navigate:function(t,e){if(!S.started)return!1;e&&e!==!0||(e={trigger:!!e});var i=this.root+(t=this.getFragment(t||""));if(t=t.replace(N,""),this.fragment!==t){if(this.fragment=t,""===t&&"/"!==i&&(i=i.slice(0,-1)),this._hasPushState)this.history[e.replace?"replaceState":"pushState"]({},document.title,i);else{if(!this._wantsHashChange)return this.location.assign(i);this._updateHash(this.location,t,e.replace),this.iframe&&t!==this.getFragment(this.getHash(this.iframe))&&(e.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,t,e.replace))}return e.trigger?this.loadUrl(t):void 0}},_updateHash:function(t,e,i){if(i){var n=t.href.replace(/(javascript:|#).*$/,"");t.replace(n+"#"+e)}else t.hash="#"+e}}),e.history=new S;var q=function(t,e){var n=this,r;r=t&&i.has(t,"constructor")?t.constructor:function(){return n.apply(this,arguments)},i.extend(r,n,e);var a=function(){this.constructor=r};return a.prototype=n.prototype,r.prototype=new a,t&&i.extend(r.prototype,t),r.__super__=n.prototype,r};p.extend=g.extend=$.extend=w.extend=S.extend=q;var z=function(){throw new Error('A "url" property or function must be specified')},R=function(t,e){var i=e.error;e.error=function(n){i&&i(t,n,e),t.trigger("error",t,n,e)}};return e});var TumblrMusic=TumblrMusic||{};!function($,t,e,i){var n=e.Model.extend({defaults:{apiKey:"ZxDKi6xiEPXafALWq2Mf1mKgAAY3L1Z5WQgEZjlFYNHao9ZPxv",limit:20},url:function(){return"http://api.tumblr.com/v2/blog/"+this.blogUrl+"/posts"},initialize:function(e){this.options=t.extend({},this.defaults,e),this.blogUrl="",this.offset=0},getPost:function(t){var e=this.get("posts");return e[t]},fetch:function(t){if(t){var i="";i=t.indexOf(".")>-1?t.replace(/.*?:\/\//g,"").replace("/",""):t+".tumblr.com",i!==this.blogUrl&&(this.offset=0),this.blogUrl=i;var n={api_key:this.options.apiKey,limit:this.options.limit,offset:this.offset,type:"audio"},r={dataType:"jsonp",data:n};return e.Model.prototype.fetch.call(this,r)}},parse:function(e){if("OK"===e.meta.msg){var i=e.response,n=i.posts,r=i.blog||{};r.avatar_url="//api.tumblr.com/v2/blog/"+this.blogUrl+"/avatar/64",t.each(n,function(t){if(!t.artist&&t.track_name){var e=t.track_name.split("-");t.artist=String(e[0]).replace(/^\s+|\s+$/g,""),t.track_name=String(e[1]).replace(/^\s+|\s+$/g,""),"undefined"===t.track_name&&(t.track_name="")}t.artist||(t.artist="Unknown"),t.track_name||(t.track_name="Untitled")}),i.blog=r,i.posts=n,console.log(i),this.set(i),this.offset+=t.size(n)}}});i.TumblrModel=n}(jQuery,_,Backbone,TumblrMusic);var TumblrMusic=TumblrMusic||{};!function($,t,e,i){var n=e.Model.extend({url:"http://ws.audioscrobbler.com/2.0/",defaults:{apiKey:"8dbe72c2e9ac59dcb06571e04ea9b132"},initialize:function(e){this.options=t.extend({},this.defaults,e)},fetch:function(t){if(t){var i={api_key:this.options.apiKey,artist:t,format:"json",method:"artist.getInfo"},n={dataType:"jsonp",data:i};return e.Model.prototype.fetch.call(this,n)}},parse:function(t){t.artist&&this.set(t.artist)}});i.LastfmModel=n}(jQuery,_,Backbone,TumblrMusic);var TumblrMusic=TumblrMusic||{};TumblrMusic.vibes={random:["http://38.media.tumblr.com/3cfaad3d26ba3979de1db7fe4dda4353/tumblr_n3n8nqtTKx1qb8pdro1_500.gif","http://38.media.tumblr.com/37031698f62295a4fa688f2327890a3b/tumblr_mwkwfmGBzz1rk4lspo1_250.gif","https://s3.amazonaws.com/giphymedia/media/NyMSZsWepPCQo/200.gif","https://s3.amazonaws.com/giphymedia/media/Vm6YGB3Ng8lnW/200.gif","https://s3.amazonaws.com/giphymedia/media/ITnn2IenMv7SE/200.gif","https://s3.amazonaws.com/giphymedia/media/2F0IsIg0lHveE/200.gif","https://s3.amazonaws.com/giphymedia/media/rDroB384ydCvK/giphy.gif","https://s3.amazonaws.com/giphymedia/media/YDo4lQwuw0YEw/giphy.gif","http://media.giphy.com/media/C5FeLQhRb48zS/giphy.gif","http://media.giphy.com/media/79erLlK2pt2zm/giphy.gif","http://media.giphy.com/media/WTNZy0ENSM20U/giphy.gif","http://media1.giphy.com/media/E6fZ47O87uC7S/giphy.gif","http://media.giphy.com/media/gpivFuK6iE3hS/giphy.gif","http://media1.giphy.com/media/oTiMS5tKgDSKY/giphy.gif","http://media.giphy.com/media/blSTtZehjAZ8I/giphy.gif","http://media.giphy.com/media/b1nVCMsZIwleE/giphy.gif","http://media3.giphy.com/media/K3Sbp8fOgKye4/giphy.gif","https://42.media.tumblr.com/086db2720f2376e49f4ad934c94dbf10/tumblr_ndxodttdYd1qbhoheo1_400.gif","https://42.media.tumblr.com/db6b17db5dcd34a0c1449a2ded95f930/tumblr_ndxodttdYd1qbhoheo2_r1_500.gif","https://42.media.tumblr.com/f9736b3773924a4cea9cc7edeec57ea7/tumblr_ndxodttdYd1qbhoheo3_r1_500.gif","http://media.giphy.com/media/j3xC30PDz2QxO/giphy.gif","http://media.giphy.com/media/11Tr8rjXzKphMA/giphy.gif","http://media.giphy.com/media/5JhUbtgDaLeFi/giphy.gif","http://media0.giphy.com/media/6E0QCowXB4D6w/giphy.gif","http://media.giphy.com/media/v0YiARQxj1yc8/giphy.gif","http://media.giphy.com/media/uWv3uPfWOz088/giphy.gif","http://media.giphy.com/media/FVaOAp809Igta/giphy.gif","http://media1.giphy.com/media/QPcjaSXN9BQty/giphy.gif","http://media3.giphy.com/media/12CEzd0Ra4qq4M/giphy.gif","http://media.giphy.com/media/c7KkBe1KAiWAM/giphy.gif","http://media.giphy.com/media/iHyt2pOyeV74k/giphy.gif","http://media.giphy.com/media/12CvxNY8J5utEs/giphy.gif"],punk:["http://38.media.tumblr.com/tumblr_m9zyn1GBbn1qfmbfwo1_1280.gif","http://33.media.tumblr.com/83bb01ee4d01423fef9e8b58a4b6272c/tumblr_n1pbldGyT21rm9sqwo1_400.gif","http://33.media.tumblr.com/4e63b4d5c919f0fa0f386f0ef99dabdb/tumblr_mi5r3k4JjO1qzqnxxo1_500.gif","http://38.media.tumblr.com/tumblr_mcjyp6KjrY1rhchkyo1_500.gif","http://38.media.tumblr.com/b5812d10ac3536258887fc8cbf19e5cb/tumblr_n01bd7Y0I31rggrn8o1_500.gif","http://31.media.tumblr.com/tumblr_lv8ohwKbEr1qd8npko1_500.gif","http://31.media.tumblr.com/a91e1cd605546fe90fc8ef639f322e7d/tumblr_mwwf3jU2IM1sl77yho1_400.gif","http://38.media.tumblr.com/tumblr_m9457mHd6L1rep0dzo1_400.gif","http://33.media.tumblr.com/cdb44deb6271f26aaead513294a6e36d/tumblr_mw2cliCQJ11qg39ewo1_500.gif","http://31.media.tumblr.com/tumblr_m1s318waMd1rswss0o1_500.gif","http://33.media.tumblr.com/46d35fd48bcfe55b9bb5a1a5d63c1c30/tumblr_ndetvzRJI41rmln2jo1_500.gif","http://38.media.tumblr.com/c7905f17957d41166bcda4086c8f9acd/tumblr_mhawv82qDr1s27ndlo1_500.gif","http://33.media.tumblr.com/45a5083f80205aa6ae025c8ae9a47fdf/tumblr_mzo98rreZs1rf41noo1_400.gif","http://38.media.tumblr.com/2f22a948cc09970e9d3cc352208e705f/tumblr_n9qmabOyn71r5mmhlo1_500.gif"],electronic:["http://31.media.tumblr.com/f92565b2fc344d04727f18385fb3c386/tumblr_mvsv4oq0tC1rnbafjo1_400.gif","http://31.media.tumblr.com/3bc5e33d3869ab42f30c7d73b65951aa/tumblr_muu2amo0vR1s2t3cto1_400.gif","http://38.media.tumblr.com/ba007c7a3021c3bea6b9a39b420a7b09/tumblr_mmibnzekHu1snb819o1_500.gif","http://38.media.tumblr.com/a9d2ee89be989f368af72830f753ca23/tumblr_n3wdnfTNJl1qg4441o1_500.gif","http://38.media.tumblr.com/66e47907ae5e2b9cbf3d839d4a69154e/tumblr_n9xspjPin11ts4htvo1_500.gif","http://33.media.tumblr.com/b9ad3142bd7d9850c00ad7ad502071b2/tumblr_n9nmqplkE41rsdpaso1_400.gif","http://38.media.tumblr.com/46c8e96fb7c410ccd38914047d302fd5/tumblr_n6puqiu7IQ1s4fz4bo1_500.gif","http://31.media.tumblr.com/7e18702914c2151c793bc86c507da10e/tumblr_n2yen3lSyW1qzw1qyo1_500.gif","http://33.media.tumblr.com/758642133ce4041af396aaa2a16616e4/tumblr_n3oqyc3PqQ1rf78nfo1_400.gif","http://33.media.tumblr.com/e251d598cdf5e1c934f4d61aaa479db4/tumblr_n0qt3gJ3GN1qax2qko1_500.gif"]};var TumblrMusic=TumblrMusic||{};!function($,t,e,i){var n=e.View.extend({el:"#index",defaults:{},events:{"keydown .search-bar":"__searchKeydown","click .track":"__trackClick","click .load-more":"__loadMoreClick"},__searchKeydown:function(t){13===t.which&&(this.username=this.$searchBar.val(),this.model.fetch(this.username),this.$searchBar.addClass("searching"))},__trackClick:function(t){t.preventDefault();var e=$(t.currentTarget);this.trigger("track:select",{trackEl:t.currentTarget,trackIndex:e.data("index"),trackAlbumArt:e.data("album-art")})},__loadMoreClick:function(t){t.preventDefault(),this.model.fetch(this.username)},_checkHash:function(){var t=window.location.hash;t?(t=t.replace("#",""),this.username=t,this.$searchBar.val(this.username),this.model.fetch(this.username)):this.$searchBar.focus()},initialize:function(e){this.options=t.extend({},this.defaults,e),this.template=t.template($("#track-list-template").html()),this.username="",this.blogUrl="",this.$searchBar=this.$(".search-bar"),this.$tracksContainer=this.$(".tracks-container"),this.$trackList=this.$(".track-list"),this.listenTo(this.model,"change",this.renderTrackList),this._checkHash()},renderTrackList:function(){var e=this.model.toJSON();if(console.log(e),!t.isEmpty(e)){this.$el.addClass("show-tracks"),this.$searchBar.removeClass("searching");var i=this.$(".load-more");i.length&&i.remove();var n=this.template(t.extend(e,{more_posts:t.size(e.posts)<e.total_posts}));this.blogUrl===e.blog.url?this.$trackList.append(n):this.$trackList.html(n),this.blogUrl=e.blog.url}}});i.IndexView=n}(jQuery,_,Backbone,TumblrMusic);var TumblrMusic=TumblrMusic||{};!function($,t,e,i){var n=e.View.extend({id:"now-playing",tagName:"section",defaults:{trackData:{},transitionDuration:800},events:{"click .pause.control":"__pauseClick","click .skip.control":"__skipClick","click .shuffle.control":"__shuffleClick","click .index.control":"__indexClick"},__pauseClick:function(t){t.preventDefault(),$(t.currentTarget).hasClass("paused")?this._play():this._pause()},__skipClick:function(t){t.preventDefault(),this._next()},__shuffleClick:function(t){t.preventDefault();var e=$(t.currentTarget);e.toggleClass("on"),this.isShuffle=e.hasClass("on")},__indexClick:function(t){t.preventDefault(),this._stop()},__windowMessage:function(t){if(t.originalEvent&&t.originalEvent.data){var e=t.originalEvent.data.split(";")[0];switch(e){case"audioPlayerReady":break;case"audioPlayerPlaying":this.isPlaying=!0,this.$pauseButton.removeClass("paused");break;case"audioPlayerPause":this.isPlaying=!1,this.$pauseButton.addClass("paused");break;case"audioPlayerEnded":this.isPlaying=!1,this._next()}}},__windowKeydown:function(t){switch(t.which){case 32:this._togglePlayPause();break;case 39:this._next();break;case 27:case 73:this._stop()}},__audioPlaying:function(){this.isPlaying=!0,this.$pauseButton.removeClass("paused")},__audioPause:function(){this.isPlaying=!1,this.$pauseButton.addClass("paused")},__audioEnded:function(){this.isPlaying=!1,this._next()},_tumblrAudioPlay:function(){this.$tumblrPlayer.length&&this.$tumblrPlayer.get(0).contentWindow.postMessage("play","*")},_tumblrAudioPause:function(){this.$tumblrPlayer.length&&this.$tumblrPlayer.get(0).contentWindow.postMessage("pause","*")},_ready:function(){this.$el.addClass("ready"),this.renderPost(this.currentIndex),this.$(".background").append(this.backgroundView.render().el)},_pause:function(){this.isTumblrPost?this._tumblrAudioPause():this.audioPlayer.pause(),this.backgroundView&&this.backgroundView.pause()},_play:function(){this.isTumblrPost?this._tumblrAudioPlay():this.audioPlayer.play(),this.backgroundView&&this.backgroundView.play()},_togglePlayPause:function(){this.isPlaying?this._pause():this._play()},_next:function(){this.renderPost(this.currentIndex+1)},_stop:function(){this.$el.removeClass("ready");var e=400;this.$audioPlayer.length&&this.$audioPlayer.animate({volume:0},e),t.delay(t.bind(this.remove,this),e)},_cacheSelectors:function(){this.$loader=this.$(".loader"),this.$nowPlaying=this.$(".now-playing-track"),this.$currentTrack=this.$(".current-track"),this.$pauseButton=this.$(".control.pause"),this.$avatar=this.$(".avatar")},initialize:function(e){this.options=t.extend({},this.defaults,e),this.trackData=this.options.trackData,this.currentPost={},this.currentIndex=this.trackData.trackIndex,this.isTumblrPost=!1,this.isShuffle=!1,this.isPlaying=!1,this.$win=$(window),this.$loader=$(),this.$nowPlaying=$(),this.$tumblrPlayer=$(),this.$pauseButton=$(),this.$avatar=$(),this.audioPlayer=new Audio,this.audioPlayer.autoplay=!1,this.audioPlayer.preload=!0,this.$audioPlayer=$(this.audioPlayer),this.backgroundView=new i.BackgroundView,this.template=t.template($("#track-template").html()),this.nowPlayingTemplate=t.template($("#now-playing-template").html()),this.$win.on("message.track-view",t.bind(this.__windowMessage,this)),this.$win.on("keydown.track-view",t.bind(this.__windowKeydown,this)),this.$audioPlayer.on("playing",t.bind(this.__audioPlaying,this)),this.$audioPlayer.on("pause",t.bind(this.__audioPause,this)),this.$audioPlayer.on("ended",t.bind(this.__audioEnded,this)),this.$container=$("#container")},render:function(){var e=$(this.trackData.trackEl),i=e.offset();return this.$el.html(this.template({album_art:this.trackData.trackAlbumArt,blog:this.model.get("blog"),preview:{left:i.left,top:i.top,height:e.height(),width:e.width()},post:this.model.getPost(this.trackData.trackIndex)})),this.$container.append(this.$el),this._cacheSelectors(),t.delay(t.bind(this._ready,this),100),this},renderPost:function(e){var i=this.model.getPost(e);t.isEmpty(i)||(this.audioPlayer&&(this.audioPlayer.pause(),this.audioPlayer.src=""),this.currentPost=i,this.currentIndex=e,this.isTumblrPost="tumblr"===i.audio_type,this.$currentTrack.html(this.nowPlayingTemplate(i)),this.$tumblrPlayer=this.$currentTrack.find(".tumblr_audio_player"),this.$avatar.attr("href",i.post_url),this.isTumblrPost||(this.audioPlayer.src=i.audio_url),t.delay(t.bind(function(){this._play(),this.backgroundView.updateArtist(i.artist)},this),this.options.transitionDuration))},remove:function(){return this.$win.off(".track-view"),this.$audioPlayer.off(),this.audioPlayer&&(this.audioPlayer.pause(),this.audioPlayer.src=""),e.View.prototype.remove.call(this)}});i.TrackView=n}(jQuery,_,Backbone,TumblrMusic);var TumblrMusic=TumblrMusic||{};!function($,t,e,i){var n=e.View.extend({className:"background-gifs",defaults:{artist:"",delay:4e3,track:""},__modelChange:function(){var e=this.model.get("tags");if(!t.isEmpty(e)){var n=e.tag[0],r=i.vibes.random;if(n){var a=n.name;a.indexOf("punk")>-1&&(a="punk"),r=i.vibes[a]||i.vibes.random}this.imageList=t.shuffle(r),this.renderImage()}},initialize:function(e){this.options=t.extend({},this.defaults,e),this.imageList=i.vibes.random,this.imageTimeout=null,this.currentImage=0,this.isPaused=!1,this.model=new i.LastfmModel,this.listenTo(this.model,"change",this.__modelChange)},pause:function(){this.imageTimeout&&(clearTimeout(this.imageTimeout),this.imageTimeout=null)},play:function(){this.pause(),this.imageTimeout=setTimeout(t.bind(this.renderImage,this),this.options.delay)},updateArtist:function(t){this.model.fetch(t)},renderImage:function(){this.pause(),this.currentImage++,this.currentImage>this.imageList.length-1&&(this.currentImage=0);var t=this.imageList[this.currentImage];return this.$el.addClass("playing").css("background-image","url("+t+")"),this.play(),this}});i.BackgroundView=n}(jQuery,_,Backbone,TumblrMusic);var TumblrMusic=TumblrMusic||{};!function($,t){var e=Backbone.View.extend({__trackSelect:function(e){this.trackView&&(this.trackView.remove(),this.trackView=null),this.trackView=new t.TrackView({model:this.model,trackData:e}).render()},initialize:function(){this.$body=$("body"),this.model=new t.TumblrModel,this.trackView=null,this.indexView=new t.IndexView({model:this.model}),this.listenTo(this.indexView,"track:select",this.__trackSelect),this.$body.removeClass("no-js")}});t.Main=e}(jQuery,TumblrMusic),$(function(){var t=new TumblrMusic.Main});